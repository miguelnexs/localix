<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de PDF con HTML - Localix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ffb6c1;
        }
        .header h1 {
            color: #8b4513;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .feature-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }
        .feature-card h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        .test-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
            font-size: 1.4em;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .btn {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 13px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        .preview-container {
            margin-top: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            background: #fafafa;
        }
        .preview-container h4 {
            color: #333;
            margin-top: 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-loading { background: #007bff; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .comparison-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
        }
        .comparison-item h4 {
            color: #333;
            margin-top: 0;
        }
        .comparison-item ul {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® PDF con HTML - Localix</h1>
            <p>Sistema avanzado de generaci√≥n de PDFs usando HTML y CSS</p>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h3>üé® Dise√±o HTML</h3>
                <p>PDFs creados con HTML y CSS para un dise√±o profesional y personalizable</p>
            </div>
            <div class="feature-card">
                <h3>üñºÔ∏è Imagen de Fondo</h3>
                <p>Imagen de fondo con transparencia para un toque elegante</p>
            </div>
            <div class="feature-card">
                <h3>üì± Responsive</h3>
                <p>Dise√±o adaptable que se ve perfecto en cualquier dispositivo</p>
            </div>
            <div class="feature-card">
                <h3>‚ö° Alta Calidad</h3>
                <p>Generaci√≥n de PDFs en alta resoluci√≥n con html2canvas</p>
            </div>
        </div>

        <div class="comparison">
            <div class="comparison-item">
                <h4>‚ùå M√©todo Anterior (jsPDF directo)</h4>
                <ul>
                    <li>Posicionamiento manual de elementos</li>
                    <li>Dif√≠cil personalizaci√≥n</li>
                    <li>Limitaciones de dise√±o</li>
                    <li>C√≥digo complejo y dif√≠cil de mantener</li>
                    <li>Sin soporte para CSS avanzado</li>
                </ul>
            </div>
            <div class="comparison-item">
                <h4>‚úÖ Nuevo M√©todo (HTML + jsPDF)</h4>
                <ul>
                    <li>Dise√±o con HTML y CSS est√°ndar</li>
                    <li>F√°cil personalizaci√≥n y mantenimiento</li>
                    <li>Dise√±os modernos y profesionales</li>
                    <li>C√≥digo limpio y organizado</li>
                    <li>Soporte completo para CSS moderno</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Pruebas del Sistema</h3>
            <p>Prueba las diferentes funcionalidades del nuevo sistema de generaci√≥n de PDFs:</p>
            
            <div class="button-group">
                <button class="btn" onclick="testImageLoading()">
                    <span class="status-indicator status-loading"></span>
                    üîç Probar Carga de Im√°genes
                </button>
                <button class="btn btn-success" onclick="generateTestPDF()">
                    üìÑ Generar PDF de Prueba
                </button>
                <button class="btn btn-secondary" onclick="showSystemInfo()">
                    ‚ÑπÔ∏è Informaci√≥n del Sistema
                </button>
            </div>

            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h3>üìã Datos de Prueba</h3>
            <p>Los siguientes datos se usar√°n para generar el PDF de prueba:</p>
            
            <div class="preview-container">
                <h4>Venta de Prueba</h4>
                <div id="test-data"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ Caracter√≠sticas del Nuevo Sistema</h3>
            <ul>
                <li><strong>Dise√±o HTML:</strong> Usa HTML y CSS para crear dise√±os profesionales</li>
                <li><strong>Imagen de Fondo:</strong> Incluye la imagen de fondo con transparencia</li>
                <li><strong>Responsive:</strong> Se adapta autom√°ticamente al contenido</li>
                <li><strong>Alta Calidad:</strong> Genera PDFs en alta resoluci√≥n</li>
                <li><strong>F√°cil Mantenimiento:</strong> C√≥digo limpio y organizado</li>
                <li><strong>Personalizable:</strong> F√°cil de modificar y personalizar</li>
            </ul>
        </div>
    </div>

    <!-- Incluir jsPDF y html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // Datos de prueba
        const testVenta = {
            id: 'TEST001',
            numero_venta: 'V-2024-001',
            fecha_venta: new Date().toISOString(),
            cliente: {
                nombre: 'Mar√≠a Gonz√°lez',
                telefono: '3001234567',
                email: 'maria.gonzalez@email.com'
            },
            items: [
                {
                    producto: { nombre: 'Blusa Elegante' },
                    color: { nombre: 'Rosa' },
                    cantidad: 2,
                    precio_unitario: 45.50,
                    subtotal: 91.00
                },
                {
                    producto: { nombre: 'Pantal√≥n Cl√°sico' },
                    color: { nombre: 'Negro' },
                    cantidad: 1,
                    precio_unitario: 65.75,
                    subtotal: 65.75
                },
                {
                    producto: { nombre: 'Accesorio Decorativo' },
                    cantidad: 3,
                    precio_unitario: 12.25,
                    subtotal: 36.75
                }
            ],
            total: 193.50,
            metodo_pago: 'Tarjeta de cr√©dito',
            observaciones: 'Productos de excelente calidad. Cliente satisfecho con la atenci√≥n recibida.'
        };

        // Funci√≥n para mostrar resultados
        function showResult(message, type = 'info') {
            const element = document.getElementById('test-results');
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        // Funci√≥n para mostrar datos de prueba
        function showTestData() {
            const element = document.getElementById('test-data');
            element.innerHTML = `
                <p><strong>N√∫mero de Venta:</strong> ${testVenta.numero_venta}</p>
                <p><strong>Cliente:</strong> ${testVenta.cliente.nombre}</p>
                <p><strong>Tel√©fono:</strong> ${testVenta.cliente.telefono}</p>
                <p><strong>Email:</strong> ${testVenta.cliente.email}</p>
                <p><strong>Productos:</strong> ${testVenta.items.length} art√≠culos</p>
                <p><strong>Total:</strong> $${testVenta.total.toFixed(2)}</p>
                <p><strong>M√©todo de Pago:</strong> ${testVenta.metodo_pago}</p>
            `;
        }

        // Funci√≥n para cargar imagen de fondo
        async function loadBackgroundImage() {
            try {
                console.log('üîç Intentando cargar imagen de fondo...');
                
                const response = await fetch('./img/logo_Mesa de trabajo 1.png');
                if (response.ok) {
                    console.log('‚úÖ Imagen de fondo cargada exitosamente');
                    const blob = await response.blob();
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    });
                } else {
                    console.log('‚ùå No se pudo cargar la imagen de fondo');
                    return null;
                }
            } catch (error) {
                console.warn('‚ùå Error al cargar la imagen de fondo:', error);
                return null;
            }
        }

        // Funci√≥n para cargar logo
        async function loadLogo() {
            try {
                console.log('üîç Intentando cargar logo...');
                
                const response = await fetch('./img/Logo.png');
                if (response.ok) {
                    console.log('‚úÖ Logo cargado exitosamente');
                    const blob = await response.blob();
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    });
                } else {
                    console.log('‚ùå No se pudo cargar el logo');
                    return null;
                }
            } catch (error) {
                console.warn('‚ùå Error al cargar el logo:', error);
                return null;
            }
        }

        // Funci√≥n para crear HTML del recibo
        function createReciboHTML(venta, logoImage, backgroundImage) {
            const fecha = new Date(venta.fecha_venta).toLocaleString('es-ES');
            const clienteNombre = venta.cliente?.nombre || venta.cliente_nombre || 'Cliente General';
            const clienteTelefono = venta.cliente?.telefono || '';
            const clienteEmail = venta.cliente?.email || '';
            
            const subtotal = venta.items?.reduce((sum, item) => sum + parseFloat(item.subtotal || 0), 0) || 0;
            
            const productosHTML = venta.items?.map(item => {
                const nombre = item.producto?.nombre || item.producto_nombre || 'Producto';
                const color = item.color?.nombre || '';
                const cantidad = item.cantidad || 0;
                const precio = parseFloat(item.precio_unitario || 0);
                const total = parseFloat(item.subtotal || 0);
                const nombreCompleto = color ? `${nombre} (${color})` : nombre;
                
                return `
                    <tr>
                        <td class="producto-nombre">${nombreCompleto}</td>
                        <td class="cantidad">${cantidad}</td>
                        <td class="precio">$${precio.toFixed(2)}</td>
                        <td class="total">$${total.toFixed(2)}</td>
                    </tr>
                `;
            }).join('') || '';

            return `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Recibo de Venta</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 0;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            background: white;
                            position: relative;
                            min-height: 100vh;
                        }
                        
                        /* Imagen de fondo con transparencia */
                        body::before {
                            content: '';
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-image: url('${backgroundImage || ''}');
                            background-size: cover;
                            background-position: center;
                            background-repeat: no-repeat;
                            opacity: 0.3;
                            z-index: -1;
                        }
                        
                        .container {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 20px;
                            background: rgba(255, 255, 255, 0.95);
                            min-height: 100vh;
                        }
                        
                        /* Header */
                        .header {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            color: #8b4513;
                            padding: 20px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
                            display: flex;
                            align-items: center;
                            gap: 20px;
                        }
                        
                        .logo {
                            width: 60px;
                            height: 60px;
                            object-fit: contain;
                            border-radius: 8px;
                            background: white;
                            padding: 5px;
                        }
                        
                        .tienda-info h1 {
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 5px;
                        }
                        
                        .tienda-info p {
                            font-size: 12px;
                            margin: 2px 0;
                        }
                        
                        /* Informaci√≥n de la venta */
                        .venta-info {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .venta-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 2px solid #ffb6c1;
                        }
                        
                        .venta-numero {
                            font-size: 20px;
                            font-weight: bold;
                            color: #ff69b4;
                        }
                        
                        .venta-fecha {
                            font-size: 14px;
                            color: #666;
                        }
                        
                        .cliente-info {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 15px;
                        }
                        
                        .cliente-item {
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        
                        .cliente-label {
                            font-weight: bold;
                            color: #8b4513;
                            min-width: 80px;
                        }
                        
                        .cliente-valor {
                            color: #333;
                        }
                        
                        /* Tabla de productos */
                        .productos-section {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            overflow: hidden;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .productos-table {
                            width: 100%;
                            border-collapse: collapse;
                        }
                        
                        .productos-table th {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            color: #8b4513;
                            padding: 15px 10px;
                            text-align: left;
                            font-weight: bold;
                            font-size: 14px;
                        }
                        
                        .productos-table td {
                            padding: 12px 10px;
                            border-bottom: 1px solid #f0f0f0;
                            font-size: 13px;
                        }
                        
                        .productos-table tr:nth-child(even) {
                            background-color: #fafafa;
                        }
                        
                        .productos-table tr:hover {
                            background-color: #f5f5f5;
                        }
                        
                        .producto-nombre {
                            font-weight: 500;
                            color: #333;
                        }
                        
                        .cantidad {
                            text-align: center;
                            font-weight: bold;
                            color: #ff69b4;
                        }
                        
                        .precio, .total {
                            text-align: right;
                            font-weight: bold;
                        }
                        
                        .precio {
                            color: #666;
                        }
                        
                        .total {
                            color: #ff69b4;
                        }
                        
                        /* Totales */
                        .totales-section {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
                        }
                        
                        .totales-grid {
                            display: grid;
                            grid-template-columns: 1fr auto;
                            gap: 10px;
                            align-items: center;
                        }
                        
                        .total-item {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 5px 0;
                        }
                        
                        .total-label {
                            font-weight: bold;
                            color: #8b4513;
                            font-size: 14px;
                        }
                        
                        .total-valor {
                            font-weight: bold;
                            color: #8b4513;
                            font-size: 14px;
                        }
                        
                        .total-final {
                            border-top: 2px solid #8b4513;
                            padding-top: 10px;
                            margin-top: 10px;
                        }
                        
                        .total-final .total-label {
                            font-size: 18px;
                        }
                        
                        .total-final .total-valor {
                            font-size: 18px;
                            color: #8b4513;
                        }
                        
                        /* M√©todo de pago */
                        .pago-section {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .pago-info {
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        
                        .pago-label {
                            font-weight: bold;
                            color: #8b4513;
                        }
                        
                        .pago-valor {
                            color: #333;
                            font-weight: 500;
                        }
                        
                        /* Observaciones */
                        ${venta.observaciones ? `
                        .observaciones-section {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .observaciones-label {
                            font-weight: bold;
                            color: #8b4513;
                            margin-bottom: 8px;
                        }
                        
                        .observaciones-texto {
                            color: #333;
                            font-style: italic;
                        }
                        ` : ''}
                        
                        /* Footer */
                        .footer {
                            text-align: center;
                            padding: 20px;
                            border-top: 3px solid #ffb6c1;
                            margin-top: 20px;
                        }
                        
                        .footer h3 {
                            color: #8b4513;
                            font-size: 16px;
                            margin-bottom: 10px;
                        }
                        
                        .footer p {
                            color: #666;
                            font-size: 12px;
                            margin: 3px 0;
                        }
                        
                        /* Responsive */
                        @media print {
                            body {
                                background: white;
                            }
                            
                            .container {
                                max-width: none;
                                padding: 0;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <!-- Header -->
                        <div class="header">
                            ${logoImage ? `<img src="${logoImage}" alt="Logo" class="logo">` : ''}
                            <div class="tienda-info">
                                <h1>Carolina Gonz√°lez Sarta</h1>
                                <p>Cra 7 # 15 57 local 101</p>
                                <p>3147435305 | 1088297299-0</p>
                                <p>carolina.gonzalez@localix.com</p>
                            </div>
                        </div>
                        
                        <!-- Informaci√≥n de la venta -->
                        <div class="venta-info">
                            <div class="venta-header">
                                <div class="venta-numero">VENTA #${venta.numero_venta || venta.id}</div>
                                <div class="venta-fecha">${fecha}</div>
                            </div>
                            
                            <div class="cliente-info">
                                <div class="cliente-item">
                                    <span class="cliente-label">Cliente:</span>
                                    <span class="cliente-valor">${clienteNombre}</span>
                                </div>
                                ${clienteTelefono ? `
                                <div class="cliente-item">
                                    <span class="cliente-label">Tel√©fono:</span>
                                    <span class="cliente-valor">${clienteTelefono}</span>
                                </div>
                                ` : ''}
                                ${clienteEmail ? `
                                <div class="cliente-item">
                                    <span class="cliente-label">Email:</span>
                                    <span class="cliente-valor">${clienteEmail}</span>
                                </div>
                                ` : ''}
                                <div class="cliente-item">
                                    <span class="cliente-label">Vendedor:</span>
                                    <span class="cliente-valor">Sistema</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabla de productos -->
                        <div class="productos-section">
                            <table class="productos-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio Unit.</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productosHTML}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Totales -->
                        <div class="totales-section">
                            <div class="totales-grid">
                                <div class="total-item">
                                    <span class="total-label">Subtotal:</span>
                                    <span class="total-valor">$${subtotal.toFixed(2)}</span>
                                </div>
                                
                                <div class="total-item total-final">
                                    <span class="total-label">TOTAL:</span>
                                    <span class="total-valor">$${venta.total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- M√©todo de pago -->
                        <div class="pago-section">
                            <div class="pago-info">
                                <span class="pago-label">M√©todo de pago:</span>
                                <span class="pago-valor">${venta.metodo_pago || 'Efectivo'}</span>
                            </div>
                        </div>
                        
                        ${venta.observaciones ? `
                        <!-- Observaciones -->
                        <div class="observaciones-section">
                            <div class="observaciones-label">Observaciones:</div>
                            <div class="observaciones-texto">${venta.observaciones}</div>
                        </div>
                        ` : ''}
                        
                        <!-- Footer -->
                        <div class="footer">
                            <h3>¬°Gracias por su compra!</h3>
                            <p>Para consultas: 3147435305</p>
                            <p>www.carolinagonzalez.com</p>
                            <p>Generado el: ${new Date().toLocaleString('es-ES')}</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Funci√≥n para generar PDF desde HTML
        async function generatePDFFromHTML(htmlContent, fileName) {
            try {
                console.log('üîÑ Generando PDF desde HTML...');
                
                // Crear un elemento temporal para el HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                tempDiv.style.width = '210mm';
                tempDiv.style.height = 'auto';
                tempDiv.style.background = 'white';
                document.body.appendChild(tempDiv);
                
                // Convertir HTML a canvas
                const canvas = await html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 794,
                    height: tempDiv.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                });
                
                // Remover el elemento temporal
                document.body.removeChild(tempDiv);
                
                // Crear PDF
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                // Agregar primera p√°gina
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Agregar p√°ginas adicionales si es necesario
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Guardar PDF
                pdf.save(fileName);
                
                console.log('‚úÖ PDF generado exitosamente');
                return pdf;
                
            } catch (error) {
                console.error('‚ùå Error al generar PDF desde HTML:', error);
                throw error;
            }
        }

        // Funci√≥n para probar carga de im√°genes
        async function testImageLoading() {
            showResult('üîÑ Probando carga de im√°genes...', 'loading');
            
            try {
                const [logoImage, backgroundImage] = await Promise.all([
                    loadLogo(),
                    loadBackgroundImage()
                ]);
                
                let result = '';
                result += `üìÖ Fecha de prueba: ${new Date().toLocaleString()}\n\n`;
                
                if (logoImage) {
                    result += `‚úÖ Logo cargado exitosamente\n`;
                    result += `üìè Tama√±o: ${logoImage.length} caracteres\n`;
                } else {
                    result += `‚ùå No se pudo cargar el logo\n`;
                }
                
                result += '\n';
                
                if (backgroundImage) {
                    result += `‚úÖ Imagen de fondo cargada exitosamente\n`;
                    result += `üìè Tama√±o: ${backgroundImage.length} caracteres\n`;
                } else {
                    result += `‚ùå No se pudo cargar la imagen de fondo\n`;
                }
                
                result += '\n';
                result += `üîß Estado: ${logoImage && backgroundImage ? 'Listo para generar PDF' : 'Algunas im√°genes faltan'}`;
                
                showResult(result, logoImage && backgroundImage ? 'success' : 'error');
                
            } catch (error) {
                showResult(`‚ùå Error en la prueba: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para generar PDF de prueba
        async function generateTestPDF() {
            showResult('üîÑ Generando PDF de prueba...', 'loading');
            
            try {
                // Cargar im√°genes
                const [logoImage, backgroundImage] = await Promise.all([
                    loadLogo(),
                    loadBackgroundImage()
                ]);
                
                // Crear HTML del recibo
                const htmlContent = createReciboHTML(testVenta, logoImage, backgroundImage);
                
                // Generar nombre del archivo
                const fecha = new Date().toISOString().split('T')[0];
                const fileName = `test_pdf_html_${fecha}.pdf`;
                
                // Generar PDF
                const pdf = await generatePDFFromHTML(htmlContent, fileName);
                
                showResult(
                    `‚úÖ PDF generado exitosamente\n` +
                    `üìÑ Archivo: ${fileName}\n` +
                    `üñºÔ∏è Logo: ${logoImage ? 'Incluido' : 'No disponible'}\n` +
                    `üñºÔ∏è Imagen de fondo: ${backgroundImage ? 'Incluida' : 'No disponible'}\n` +
                    `üìÖ Fecha: ${new Date().toLocaleString()}`,
                    'success'
                );
                
            } catch (error) {
                showResult(`‚ùå Error al generar PDF: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para mostrar informaci√≥n del sistema
        function showSystemInfo() {
            const info = 
                `üåê Navegador: ${navigator.userAgent}\n` +
                `üì± Plataforma: ${navigator.platform}\n` +
                `üîß jsPDF: ${window.jspdf ? 'Disponible' : 'No disponible'}\n` +
                `üé® html2canvas: ${window.html2canvas ? 'Disponible' : 'No disponible'}\n` +
                `üìÅ URL actual: ${window.location.href}\n` +
                `üïí Fecha: ${new Date().toLocaleString()}\n\n` +
                `‚ú® Nuevas caracter√≠sticas:\n` +
                `‚Ä¢ Generaci√≥n de PDFs usando HTML y CSS\n` +
                `‚Ä¢ Imagen de fondo con transparencia\n` +
                `‚Ä¢ Dise√±os modernos y profesionales\n` +
                `‚Ä¢ C√≥digo limpio y mantenible\n` +
                `‚Ä¢ Alta calidad de impresi√≥n`;
            
            showResult(info, 'info');
        }

        // Inicializar p√°gina
        window.onload = function() {
            showTestData();
            console.log('üöÄ P√°gina de prueba HTML-PDF cargada correctamente');
        };
    </script>
</body>
</html> 