<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de PDF de Pedidos - Localix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ffb6c1;
        }
        .header h1 {
            color: #8b4513;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .feature-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }
        .feature-card h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        .test-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
            font-size: 1.4em;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .btn {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 13px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        .pedido-preview {
            margin-top: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            background: #fafafa;
        }
        .pedido-preview h4 {
            color: #333;
            margin-top: 0;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .comparison-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
        }
        .comparison-item h4 {
            color: #333;
            margin-top: 0;
        }
        .comparison-item ul {
            color: #666;
            line-height: 1.6;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-loading { background: #007bff; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ PDF de Pedidos - Localix</h1>
            <p>Sistema avanzado de generaci√≥n de PDFs de pedidos usando HTML y CSS</p>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h3>üé® Dise√±o HTML</h3>
                <p>PDFs de pedidos creados con HTML y CSS para un dise√±o profesional</p>
            </div>
            <div class="feature-card">
                <h3>üñºÔ∏è Imagen de Fondo</h3>
                <p>Imagen de fondo con transparencia para un toque elegante</p>
            </div>
            <div class="feature-card">
                <h3>üìã Informaci√≥n Completa</h3>
                <p>Incluye toda la informaci√≥n del pedido, cliente y productos</p>
            </div>
            <div class="feature-card">
                <h3>‚ö° Alta Calidad</h3>
                <p>Generaci√≥n de PDFs en alta resoluci√≥n con html2canvas</p>
            </div>
        </div>

        <div class="comparison">
            <div class="comparison-item">
                <h4>‚ùå M√©todo Anterior (jsPDF directo)</h4>
                <ul>
                    <li>Posicionamiento manual de elementos</li>
                    <li>Dif√≠cil manejo de informaci√≥n compleja</li>
                    <li>Limitaciones en dise√±o de tablas</li>
                    <li>C√≥digo complejo para pedidos</li>
                    <li>Sin soporte para estados visuales</li>
                </ul>
            </div>
            <div class="comparison-item">
                <h4>‚úÖ Nuevo M√©todo (HTML + jsPDF)</h4>
                <ul>
                    <li>Dise√±o con HTML y CSS est√°ndar</li>
                    <li>F√°cil manejo de informaci√≥n compleja</li>
                    <li>Tablas profesionales y organizadas</li>
                    <li>C√≥digo limpio y mantenible</li>
                    <li>Estados visuales con colores</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Pruebas del Sistema de Pedidos</h3>
            <p>Prueba las diferentes funcionalidades del nuevo sistema de generaci√≥n de PDFs de pedidos:</p>
            
            <div class="button-group">
                <button class="btn" onclick="testImageLoading()">
                    <span class="status-indicator status-loading"></span>
                    üîç Probar Carga de Im√°genes
                </button>
                <button class="btn btn-success" onclick="generateTestPedidoPDF()">
                    üìÑ Generar PDF de Pedido de Prueba
                </button>
                <button class="btn btn-secondary" onclick="showSystemInfo()">
                    ‚ÑπÔ∏è Informaci√≥n del Sistema
                </button>
            </div>

            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h3>üìã Datos del Pedido de Prueba</h3>
            <p>Los siguientes datos se usar√°n para generar el PDF de pedido de prueba:</p>
            
            <div class="pedido-preview">
                <h4>Pedido de Prueba</h4>
                <div id="pedido-data"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ Caracter√≠sticas Espec√≠ficas de Pedidos</h3>
            <ul>
                <li><strong>Informaci√≥n Completa:</strong> N√∫mero de pedido, fecha, estado, cliente</li>
                <li><strong>Informaci√≥n de Entrega:</strong> Direcci√≥n, tel√©fono, instrucciones</li>
                <li><strong>Tabla de Productos:</strong> SKU, colores, cantidades, precios</li>
                <li><strong>Estados Visuales:</strong> Badges de colores para estados del pedido</li>
                <li><strong>Informaci√≥n Adicional:</strong> M√©todo de pago, seguimiento, empresa de env√≠o</li>
                <li><strong>Observaciones:</strong> Notas y comentarios del pedido</li>
            </ul>
        </div>
    </div>

    <!-- Incluir jsPDF y html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // Datos de pedido de prueba
        const testPedido = {
            id: 'TEST001',
            numero_pedido: 'PED-2024-001',
            fecha_creacion: new Date().toISOString(),
            estado_pedido: 'confirmado',
            tipo_venta: 'fisica',
            estado_pago: 'pagado',
            metodo_pago: 'Tarjeta de cr√©dito',
            cliente: {
                nombre: 'Mar√≠a Gonz√°lez',
                telefono: '3001234567',
                email: 'maria.gonzalez@email.com',
                direccion: 'Calle 123 # 45-67, Bogot√°'
            },
            direccion_entrega: 'Calle 123 # 45-67, Bogot√°',
            telefono_contacto: '3001234567',
            instrucciones_entrega: 'Entregar en horario de oficina',
            items: [
                {
                    producto: { nombre: 'Blusa Elegante', sku: 'BLU-001' },
                    color: { nombre: 'Rosa' },
                    cantidad: 2,
                    precio_unitario: 45.50,
                    subtotal: 91.00
                },
                {
                    producto: { nombre: 'Pantal√≥n Cl√°sico', sku: 'PAN-002' },
                    color: { nombre: 'Negro' },
                    cantidad: 1,
                    precio_unitario: 65.75,
                    subtotal: 65.75
                },
                {
                    producto: { nombre: 'Accesorio Decorativo', sku: 'ACC-003' },
                    cantidad: 3,
                    precio_unitario: 12.25,
                    subtotal: 36.75
                }
            ],
            total: 193.50,
            codigo_seguimiento: 'TRK-123456789',
            empresa_envio: 'Servientrega',
            notas: 'Pedido especial con instrucciones de empaque espec√≠ficas. Cliente solicita entrega antes del mediod√≠a.'
        };

        // Funci√≥n para mostrar resultados
        function showResult(message, type = 'info') {
            const element = document.getElementById('test-results');
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        // Funci√≥n para mostrar datos del pedido
        function showPedidoData() {
            const element = document.getElementById('pedido-data');
            element.innerHTML = `
                <p><strong>N√∫mero de Pedido:</strong> ${testPedido.numero_pedido}</p>
                <p><strong>Cliente:</strong> ${testPedido.cliente.nombre}</p>
                <p><strong>Tel√©fono:</strong> ${testPedido.cliente.telefono}</p>
                <p><strong>Email:</strong> ${testPedido.cliente.email}</p>
                <p><strong>Estado:</strong> ${testPedido.estado_pedido}</p>
                <p><strong>Productos:</strong> ${testPedido.items.length} art√≠culos</p>
                <p><strong>Total:</strong> $${testPedido.total.toFixed(2)}</p>
                <p><strong>M√©todo de Pago:</strong> ${testPedido.metodo_pago}</p>
                <p><strong>C√≥digo de Seguimiento:</strong> ${testPedido.codigo_seguimiento}</p>
            `;
        }

        // Funci√≥n para cargar imagen de fondo
        async function loadBackgroundImage() {
            try {
                console.log('üîç Intentando cargar imagen de fondo...');
                
                const response = await fetch('./img/logo_Mesa de trabajo 1.png');
                if (response.ok) {
                    console.log('‚úÖ Imagen de fondo cargada exitosamente');
                    const blob = await response.blob();
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    });
                } else {
                    console.log('‚ùå No se pudo cargar la imagen de fondo');
                    return null;
                }
            } catch (error) {
                console.warn('‚ùå Error al cargar la imagen de fondo:', error);
                return null;
            }
        }

        // Funci√≥n para cargar logo
        async function loadLogo() {
            try {
                console.log('üîç Intentando cargar logo...');
                
                const response = await fetch('./img/Logo.png');
                if (response.ok) {
                    console.log('‚úÖ Logo cargado exitosamente');
                    const blob = await response.blob();
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    });
                } else {
                    console.log('‚ùå No se pudo cargar el logo');
                    return null;
                }
            } catch (error) {
                console.warn('‚ùå Error al cargar el logo:', error);
                return null;
            }
        }

        // Funci√≥n para obtener el texto del estado del pedido
        function getEstadoText(estado) {
            switch (estado) {
                case 'pendiente':
                    return 'Pendiente';
                case 'confirmado':
                    return 'Confirmado';
                case 'en_preparacion':
                    return 'En Preparaci√≥n';
                case 'enviado':
                    return 'Enviado';
                case 'entregado':
                    return 'Entregado';
                case 'cancelado':
                    return 'Cancelado';
                default:
                    return estado || 'Pendiente';
            }
        }

        // Funci√≥n para obtener el color del estado
        function getEstadoColor(estado) {
            switch (estado) {
                case 'pendiente':
                    return '#fbbf24';
                case 'confirmado':
                    return '#3b82f6';
                case 'en_preparacion':
                    return '#f97316';
                case 'enviado':
                    return '#8b5cf6';
                case 'entregado':
                    return '#10b981';
                case 'cancelado':
                    return '#ef4444';
                default:
                    return '#6b7280';
            }
        }

        // Funci√≥n para crear el HTML del pedido
        function createPedidoHTML(pedido, logoImage, backgroundImage) {
            const fecha = pedido.fecha_creacion ? new Date(pedido.fecha_creacion).toLocaleString('es-ES') : new Date().toLocaleString('es-ES');
            const clienteNombre = pedido.cliente?.nombre || pedido.cliente_nombre || 'Cliente General';
            const clienteTelefono = pedido.cliente?.telefono || pedido.telefono_contacto || '';
            const clienteEmail = pedido.cliente?.email || '';
            const clienteDireccion = pedido.cliente?.direccion || pedido.direccion_entrega || '';
            
            const subtotal = pedido.items?.reduce((sum, item) => sum + parseFloat(item.subtotal || 0), 0) || 0;
            
            const productosHTML = pedido.items?.map(item => {
                const nombre = (item.producto && item.producto.nombre) || item.producto_nombre || 'Producto';
                const sku = (item.producto && item.producto.sku) || item.sku || '';
                
                let colorNombre = '';
                if (item.color) {
                    if (typeof item.color === 'object' && item.color.nombre) {
                        colorNombre = item.color.nombre;
                    } else if (typeof item.color === 'string') {
                        colorNombre = item.color;
                    }
                } else if (item.producto) {
                    if (item.producto.variante && (item.producto.variante.color_nombre || item.producto.variante.color)) {
                        colorNombre = item.producto.variante.color_nombre || item.producto.variante.color;
                    } else if (item.producto.color_nombre || item.producto.color) {
                        colorNombre = item.producto.color_nombre || item.producto.color;
                    }
                } else if (item.variante && (item.variante.color_nombre || item.variante.color)) {
                    colorNombre = item.variante.color_nombre || item.variante.color;
                } else if (item.color_nombre || item.color) {
                    colorNombre = item.color_nombre || item.color;
                }
                
                const cantidad = item.cantidad || 0;
                const precio = parseFloat(item.precio_unitario || 0);
                const total = parseFloat(item.subtotal || 0);
                
                return `
                    <tr>
                        <td class="producto-nombre">${nombre}</td>
                        <td class="sku">${sku}</td>
                        <td class="color">${colorNombre}</td>
                        <td class="cantidad">${cantidad}</td>
                        <td class="precio">$${precio.toFixed(2)}</td>
                        <td class="total">$${total.toFixed(2)}</td>
                    </tr>
                `;
            }).join('') || '';

            return `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Pedido</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 0;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            background: white;
                            position: relative;
                            min-height: 100vh;
                        }
                        
                        body::before {
                            content: '';
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-image: url('${backgroundImage || ''}');
                            background-size: cover;
                            background-position: center;
                            background-repeat: no-repeat;
                            opacity: 0.3;
                            z-index: -1;
                        }
                        
                        .container {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 20px;
                            background: rgba(255, 255, 255, 0.95);
                            min-height: 100vh;
                        }
                        
                        .header {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            color: #8b4513;
                            padding: 20px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
                            display: flex;
                            align-items: center;
                            gap: 20px;
                        }
                        
                        .logo {
                            width: 60px;
                            height: 60px;
                            object-fit: contain;
                            border-radius: 8px;
                            background: white;
                            padding: 5px;
                        }
                        
                        .tienda-info h1 {
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 5px;
                        }
                        
                        .tienda-info p {
                            font-size: 12px;
                            margin: 2px 0;
                        }
                        
                        .pedido-info {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .pedido-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 2px solid #ffb6c1;
                        }
                        
                        .pedido-numero {
                            font-size: 20px;
                            font-weight: bold;
                            color: #ff69b4;
                        }
                        
                        .pedido-fecha {
                            font-size: 14px;
                            color: #666;
                        }
                        
                        .estado-badge {
                            display: inline-block;
                            padding: 5px 12px;
                            border-radius: 20px;
                            color: white;
                            font-weight: bold;
                            font-size: 12px;
                            background-color: ${getEstadoColor(pedido.estado_pedido)};
                        }
                        
                        .cliente-info {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 15px;
                        }
                        
                        .cliente-item {
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        
                        .cliente-label {
                            font-weight: bold;
                            color: #8b4513;
                            min-width: 80px;
                        }
                        
                        .cliente-valor {
                            color: #333;
                        }
                        
                        .entrega-info {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .entrega-info h3 {
                            color: #8b4513;
                            font-size: 16px;
                            margin-bottom: 10px;
                            border-bottom: 1px solid #ffb6c1;
                            padding-bottom: 5px;
                        }
                        
                        .entrega-item {
                            margin-bottom: 8px;
                        }
                        
                        .entrega-label {
                            font-weight: bold;
                            color: #8b4513;
                            margin-right: 10px;
                        }
                        
                        .entrega-valor {
                            color: #333;
                        }
                        
                        .productos-section {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            overflow: hidden;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .productos-table {
                            width: 100%;
                            border-collapse: collapse;
                        }
                        
                        .productos-table th {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            color: #8b4513;
                            padding: 15px 8px;
                            text-align: left;
                            font-weight: bold;
                            font-size: 12px;
                        }
                        
                        .productos-table td {
                            padding: 12px 8px;
                            border-bottom: 1px solid #f0f0f0;
                            font-size: 11px;
                        }
                        
                        .productos-table tr:nth-child(even) {
                            background-color: #fafafa;
                        }
                        
                        .producto-nombre {
                            font-weight: 500;
                            color: #333;
                            max-width: 120px;
                            word-wrap: break-word;
                        }
                        
                        .sku {
                            color: #666;
                            font-family: monospace;
                            font-size: 10px;
                        }
                        
                        .color {
                            color: #ff69b4;
                            font-weight: 500;
                        }
                        
                        .cantidad {
                            text-align: center;
                            font-weight: bold;
                            color: #ff69b4;
                        }
                        
                        .precio, .total {
                            text-align: right;
                            font-weight: bold;
                        }
                        
                        .precio {
                            color: #666;
                        }
                        
                        .total {
                            color: #ff69b4;
                        }
                        
                        .totales-section {
                            background: linear-gradient(135deg, #ffb6c1, #ff69b4);
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
                        }
                        
                        .totales-grid {
                            display: grid;
                            grid-template-columns: 1fr auto;
                            gap: 10px;
                            align-items: center;
                        }
                        
                        .total-item {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 5px 0;
                        }
                        
                        .total-label {
                            font-weight: bold;
                            color: #8b4513;
                            font-size: 14px;
                        }
                        
                        .total-valor {
                            font-weight: bold;
                            color: #8b4513;
                            font-size: 14px;
                        }
                        
                        .total-final {
                            border-top: 2px solid #8b4513;
                            padding-top: 10px;
                            margin-top: 10px;
                        }
                        
                        .total-final .total-label {
                            font-size: 18px;
                        }
                        
                        .total-final .total-valor {
                            font-size: 18px;
                            color: #8b4513;
                        }
                        
                        .info-adicional {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .info-adicional h3 {
                            color: #8b4513;
                            font-size: 16px;
                            margin-bottom: 10px;
                            border-bottom: 1px solid #ffb6c1;
                            padding-bottom: 5px;
                        }
                        
                        .info-item {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 8px;
                        }
                        
                        .info-label {
                            font-weight: bold;
                            color: #8b4513;
                        }
                        
                        .info-valor {
                            color: #333;
                        }
                        
                        .observaciones-section {
                            background: white;
                            border: 2px solid #ffb6c1;
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 20px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        
                        .observaciones-label {
                            font-weight: bold;
                            color: #8b4513;
                            margin-bottom: 8px;
                        }
                        
                        .observaciones-texto {
                            color: #333;
                            font-style: italic;
                            line-height: 1.5;
                        }
                        
                        .footer {
                            text-align: center;
                            padding: 20px;
                            border-top: 3px solid #ffb6c1;
                            margin-top: 20px;
                        }
                        
                        .footer h3 {
                            color: #8b4513;
                            font-size: 16px;
                            margin-bottom: 10px;
                        }
                        
                        .footer p {
                            color: #666;
                            font-size: 12px;
                            margin: 3px 0;
                        }
                        
                        @media print {
                            body {
                                background: white;
                            }
                            
                            .container {
                                max-width: none;
                                padding: 0;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            ${logoImage ? `<img src="${logoImage}" alt="Logo" class="logo">` : ''}
                            <div class="tienda-info">
                                <h1>Carolina Gonz√°lez Sarta</h1>
                                <p>Cra 7 # 15 57 local 101</p>
                                <p>3147435305 | 1088297299-0</p>
                                <p>carolina.gonzalez@localix.com</p>
                            </div>
                        </div>
                        
                        <div class="pedido-info">
                            <div class="pedido-header">
                                <div>
                                    <div class="pedido-numero">PEDIDO #${pedido.numero_pedido || ''}</div>
                                    <div class="pedido-fecha">${fecha}</div>
                                </div>
                                <div class="estado-badge">${getEstadoText(pedido.estado_pedido)}</div>
                            </div>
                            
                            <div class="cliente-info">
                                <div class="cliente-item">
                                    <span class="cliente-label">Cliente:</span>
                                    <span class="cliente-valor">${clienteNombre}</span>
                                </div>
                                ${clienteTelefono ? `
                                <div class="cliente-item">
                                    <span class="cliente-label">Tel√©fono:</span>
                                    <span class="cliente-valor">${clienteTelefono}</span>
                                </div>
                                ` : ''}
                                ${clienteEmail ? `
                                <div class="cliente-item">
                                    <span class="cliente-label">Email:</span>
                                    <span class="cliente-valor">${clienteEmail}</span>
                                </div>
                                ` : ''}
                                ${clienteDireccion ? `
                                <div class="cliente-item">
                                    <span class="cliente-label">Direcci√≥n:</span>
                                    <span class="cliente-valor">${clienteDireccion}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="entrega-info">
                            <h3>Informaci√≥n de Entrega</h3>
                            ${pedido.direccion_entrega ? `
                            <div class="entrega-item">
                                <span class="entrega-label">Direcci√≥n:</span>
                                <span class="entrega-valor">${pedido.direccion_entrega}</span>
                            </div>
                            ` : ''}
                            ${pedido.telefono_contacto ? `
                            <div class="entrega-item">
                                <span class="entrega-label">Tel√©fono:</span>
                                <span class="entrega-valor">${pedido.telefono_contacto}</span>
                            </div>
                            ` : ''}
                            ${pedido.instrucciones_entrega ? `
                            <div class="entrega-item">
                                <span class="entrega-label">Instrucciones:</span>
                                <span class="entrega-valor">${pedido.instrucciones_entrega}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="productos-section">
                            <table class="productos-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>SKU</th>
                                        <th>Color</th>
                                        <th>Cantidad</th>
                                        <th>Precio Unit.</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productosHTML}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="totales-section">
                            <div class="totales-grid">
                                <div class="total-item">
                                    <span class="total-label">Subtotal:</span>
                                    <span class="total-valor">$${subtotal.toFixed(2)}</span>
                                </div>
                                
                                <div class="total-item total-final">
                                    <span class="total-label">TOTAL:</span>
                                    <span class="total-valor">$${pedido.total?.toFixed(2) || subtotal.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-adicional">
                            <h3>Informaci√≥n Adicional</h3>
                            <div class="info-item">
                                <span class="info-label">Tipo de Venta:</span>
                                <span class="info-valor">${pedido.tipo_venta === 'fisica' ? 'Venta F√≠sica' : 'Venta Digital'}</span>
                            </div>
                            ${pedido.metodo_pago ? `
                            <div class="info-item">
                                <span class="info-label">M√©todo de Pago:</span>
                                <span class="info-valor">${pedido.metodo_pago}</span>
                            </div>
                            ` : ''}
                            ${pedido.estado_pago ? `
                            <div class="info-item">
                                <span class="info-label">Estado de Pago:</span>
                                <span class="info-valor">${pedido.estado_pago}</span>
                            </div>
                            ` : ''}
                            ${pedido.codigo_seguimiento ? `
                            <div class="info-item">
                                <span class="info-label">C√≥digo de Seguimiento:</span>
                                <span class="info-valor">${pedido.codigo_seguimiento}</span>
                            </div>
                            ` : ''}
                            ${pedido.empresa_envio ? `
                            <div class="info-item">
                                <span class="info-label">Empresa de Env√≠o:</span>
                                <span class="info-valor">${pedido.empresa_envio}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="observaciones-section">
                            <div class="observaciones-label">Observaciones:</div>
                            <div class="observaciones-texto">${pedido.notas}</div>
                        </div>
                        
                        <div class="footer">
                            <h3>¬°Gracias por tu pedido!</h3>
                            <p>Para consultas sobre el estado de tu pedido: 3147435305</p>
                            <p>www.carolinagonzalez.com</p>
                            <p>Generado el: ${new Date().toLocaleString('es-ES')}</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Funci√≥n para generar PDF desde HTML
        async function generatePDFFromHTML(htmlContent, fileName) {
            try {
                console.log('üîÑ Generando PDF desde HTML...');
                
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                tempDiv.style.width = '210mm';
                tempDiv.style.height = 'auto';
                tempDiv.style.background = 'white';
                document.body.appendChild(tempDiv);
                
                const canvas = await html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 794,
                    height: tempDiv.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                });
                
                document.body.removeChild(tempDiv);
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(fileName);
                
                console.log('‚úÖ PDF generado exitosamente');
                return pdf;
                
            } catch (error) {
                console.error('‚ùå Error al generar PDF desde HTML:', error);
                throw error;
            }
        }

        // Funci√≥n para probar carga de im√°genes
        async function testImageLoading() {
            showResult('üîÑ Probando carga de im√°genes...', 'loading');
            
            try {
                const [logoImage, backgroundImage] = await Promise.all([
                    loadLogo(),
                    loadBackgroundImage()
                ]);
                
                let result = '';
                result += `üìÖ Fecha de prueba: ${new Date().toLocaleString()}\n\n`;
                
                if (logoImage) {
                    result += `‚úÖ Logo cargado exitosamente\n`;
                    result += `üìè Tama√±o: ${logoImage.length} caracteres\n`;
                } else {
                    result += `‚ùå No se pudo cargar el logo\n`;
                }
                
                result += '\n';
                
                if (backgroundImage) {
                    result += `‚úÖ Imagen de fondo cargada exitosamente\n`;
                    result += `üìè Tama√±o: ${backgroundImage.length} caracteres\n`;
                } else {
                    result += `‚ùå No se pudo cargar la imagen de fondo\n`;
                }
                
                result += '\n';
                result += `üîß Estado: ${logoImage && backgroundImage ? 'Listo para generar PDF' : 'Algunas im√°genes faltan'}`;
                
                showResult(result, logoImage && backgroundImage ? 'success' : 'error');
                
            } catch (error) {
                showResult(`‚ùå Error en la prueba: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para generar PDF de pedido de prueba
        async function generateTestPedidoPDF() {
            showResult('üîÑ Generando PDF de pedido de prueba...', 'loading');
            
            try {
                const [logoImage, backgroundImage] = await Promise.all([
                    loadLogo(),
                    loadBackgroundImage()
                ]);
                
                const htmlContent = createPedidoHTML(testPedido, logoImage, backgroundImage);
                
                const fecha = new Date().toISOString().split('T')[0];
                const fileName = `test_pedido_${fecha}.pdf`;
                
                const pdf = await generatePDFFromHTML(htmlContent, fileName);
                
                showResult(
                    `‚úÖ PDF de pedido generado exitosamente\n` +
                    `üìÑ Archivo: ${fileName}\n` +
                    `üñºÔ∏è Logo: ${logoImage ? 'Incluido' : 'No disponible'}\n` +
                    `üñºÔ∏è Imagen de fondo: ${backgroundImage ? 'Incluida' : 'No disponible'}\n` +
                    `üì¶ Productos: ${testPedido.items.length} art√≠culos\n` +
                    `üìÖ Fecha: ${new Date().toLocaleString()}`,
                    'success'
                );
                
            } catch (error) {
                showResult(`‚ùå Error al generar PDF: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para mostrar informaci√≥n del sistema
        function showSystemInfo() {
            const info = 
                `üåê Navegador: ${navigator.userAgent}\n` +
                `üì± Plataforma: ${navigator.platform}\n` +
                `üîß jsPDF: ${window.jspdf ? 'Disponible' : 'No disponible'}\n` +
                `üé® html2canvas: ${window.html2canvas ? 'Disponible' : 'No disponible'}\n` +
                `üìÅ URL actual: ${window.location.href}\n` +
                `üïí Fecha: ${new Date().toLocaleString()}\n\n` +
                `‚ú® Caracter√≠sticas espec√≠ficas de pedidos:\n` +
                `‚Ä¢ Informaci√≥n completa del pedido y cliente\n` +
                `‚Ä¢ Informaci√≥n de entrega detallada\n` +
                `‚Ä¢ Tabla de productos con SKU y colores\n` +
                `‚Ä¢ Estados visuales con badges de colores\n` +
                `‚Ä¢ Informaci√≥n adicional (pago, seguimiento)\n` +
                `‚Ä¢ Observaciones y notas del pedido`;
            
            showResult(info, 'info');
        }

        // Inicializar p√°gina
        window.onload = function() {
            showPedidoData();
            console.log('üöÄ P√°gina de prueba de PDF de pedidos cargada correctamente');
        };
    </script>
</body>
</html> 